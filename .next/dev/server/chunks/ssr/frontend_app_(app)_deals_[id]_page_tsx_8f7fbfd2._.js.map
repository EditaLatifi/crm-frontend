{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Desktop/CRM/frontend/app/%28app%29/deals/%5Bid%5D/page.tsx"],"sourcesContent":["\r\n\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport default function DealDetailsPage({ params }: { params: { id: string } }) {\r\n  const [notes, setNotes] = useState<any[]>([]);\r\n  const [attachments, setAttachments] = useState<any[]>([]);\r\n  const [noteContent, setNoteContent] = useState(\"\");\r\n  const [attachmentUrl, setAttachmentUrl] = useState(\"\");\r\n  const [attachmentFilename, setAttachmentFilename] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [deal, setDeal] = useState<any>(null);\r\n  const [tasks, setTasks] = useState<any[]>([]);\r\n  const [account, setAccount] = useState<any>(null);\r\n  const [contacts, setContacts] = useState<any[]>([]);\r\n\r\n  const fetchNotes = async () => {\r\n    const res = await fetch(`/api/deals/${params.id}/notes`);\r\n    setNotes(await res.json());\r\n  };\r\n  const fetchAttachments = async () => {\r\n    const res = await fetch(`/api/deals/${params.id}/attachments`);\r\n    setAttachments(await res.json());\r\n  };\r\n  const fetchDeal = async () => {\r\n    const res = await fetch(`/api/deals/${params.id}`);\r\n    const d = await res.json();\r\n    setDeal(d);\r\n    // Fetch related account\r\n    if (d.accountId) {\r\n      const accRes = await fetch(`/api/accounts/${d.accountId}`);\r\n      setAccount(await accRes.json());\r\n    }\r\n    // Fetch related tasks\r\n    const tasksRes = await fetch(`/api/tasks?dealId=${params.id}`);\r\n    setTasks(await tasksRes.json());\r\n    // Fetch related contacts (via account)\r\n    if (d.accountId) {\r\n      const contactsRes = await fetch(`/api/contacts?accountId=${d.accountId}`);\r\n      setContacts(await contactsRes.json());\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    Promise.all([fetchNotes(), fetchAttachments(), fetchDeal()]).then(() => setLoading(false));\r\n  }, []);\r\n\r\n  const handleAddNote = async (e: any) => {\r\n    e.preventDefault();\r\n    await fetch(`/api/deals/${params.id}/notes`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ content: noteContent }),\r\n    });\r\n    setNoteContent(\"\");\r\n    fetchNotes();\r\n  };\r\n\r\n  const handleAddAttachment = async (e: any) => {\r\n    e.preventDefault();\r\n    await fetch(`/api/deals/${params.id}/attachments`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ url: attachmentUrl, filename: attachmentFilename }),\r\n    });\r\n    setAttachmentUrl(\"\");\r\n    setAttachmentFilename(\"\");\r\n    fetchAttachments();\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: 24 }}>\r\n      <h1>Deal Details</h1>\r\n      {deal && (\r\n        <div style={{ marginBottom: 32 }}>\r\n          <div><b>Name:</b> {deal.name}</div>\r\n          <div><b>Amount:</b> {deal.amount} {deal.currency}</div>\r\n          <div><b>Probability:</b> {deal.probability}%</div>\r\n          <div><b>Score:</b> {deal.dealScore}</div>\r\n          <div><b>Stage:</b> {deal.stageId}</div>\r\n          <div><b>Expected Close:</b> {deal.expectedCloseDate ? new Date(deal.expectedCloseDate).toLocaleDateString() : ''}</div>\r\n        </div>\r\n      )}\r\n      {account && (\r\n        <div style={{ marginBottom: 24 }}>\r\n          <h2>Account</h2>\r\n          <div><b>Name:</b> {account.name}</div>\r\n          <div><b>Type:</b> {account.type}</div>\r\n        </div>\r\n      )}\r\n      {contacts.length > 0 && (\r\n        <div style={{ marginBottom: 24 }}>\r\n          <h2>Contacts</h2>\r\n          <ul>\r\n            {contacts.map((c: any) => (\r\n              <li key={c.id}>{c.name} ({c.email})</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      {tasks.length > 0 && (\r\n        <div style={{ marginBottom: 24 }}>\r\n          <h2>Tasks</h2>\r\n          <ul>\r\n            {tasks.map((t: any) => (\r\n              <li key={t.id}>{t.title} - {t.status}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      <div style={{ marginBottom: 32 }}>\r\n        <h2>Notes</h2>\r\n        <form onSubmit={handleAddNote} style={{ marginBottom: 16 }}>\r\n          <textarea value={noteContent} onChange={e => setNoteContent(e.target.value)} placeholder=\"Add a note...\" style={{ width: 320, minHeight: 60, borderRadius: 4, border: '1px solid #ccc', padding: 8 }} />\r\n          <br />\r\n          <button type=\"submit\" style={{ marginTop: 8, background: '#0052cc', color: '#fff', border: 'none', borderRadius: 4, padding: '6px 16px', cursor: 'pointer' }}>Add Note</button>\r\n        </form>\r\n        <div>\r\n          {notes.length === 0 && <div style={{ color: '#888' }}>No notes yet.</div>}\r\n          {notes.map((n: any) => (\r\n            <div key={n.id} style={{ background: '#fafbfc', border: '1px solid #eee', borderRadius: 4, padding: 12, marginBottom: 8 }}>\r\n              <div style={{ fontSize: 14 }}>{n.content}</div>\r\n              <div style={{ fontSize: 12, color: '#888' }}>By {n.createdByUserId} on {new Date(n.createdAt).toLocaleString()}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n      <div style={{ marginBottom: 32 }}>\r\n        <h2>Attachments</h2>\r\n        <form onSubmit={handleAddAttachment} style={{ marginBottom: 16 }}>\r\n          <input value={attachmentFilename} onChange={e => setAttachmentFilename(e.target.value)} placeholder=\"Filename\" style={{ width: 180, marginRight: 8, borderRadius: 4, border: '1px solid #ccc', padding: 6 }} />\r\n          <input value={attachmentUrl} onChange={e => setAttachmentUrl(e.target.value)} placeholder=\"File URL\" style={{ width: 220, marginRight: 8, borderRadius: 4, border: '1px solid #ccc', padding: 6 }} />\r\n          <button type=\"submit\" style={{ background: '#0052cc', color: '#fff', border: 'none', borderRadius: 4, padding: '6px 16px', cursor: 'pointer' }}>Add Attachment</button>\r\n        </form>\r\n        <div>\r\n          {attachments.length === 0 && <div style={{ color: '#888' }}>No attachments yet.</div>}\r\n          {attachments.map((a: any) => (\r\n            <div key={a.id} style={{ background: '#fafbfc', border: '1px solid #eee', borderRadius: 4, padding: 12, marginBottom: 8 }}>\r\n              <a href={a.url} target=\"_blank\" rel=\"noopener noreferrer\">{a.filename}</a>\r\n              <div style={{ fontSize: 12, color: '#888' }}>By {a.uploadedByUserId} on {new Date(a.createdAt).toLocaleString()}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}