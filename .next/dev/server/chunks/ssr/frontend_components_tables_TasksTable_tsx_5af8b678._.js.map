{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Desktop/CRM/frontend/components/tables/TasksTable.tsx"],"sourcesContent":["\r\n\"use client\";\r\nimport { useEffect, useState } from 'react';\r\nimport { Box, Flex, Heading, VStack, Text, Tag, Avatar, Spinner } from '@chakra-ui/react';\r\nimport { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';\r\nimport Link from 'next/link';\r\n\r\nconst statusColumns = [\r\n  { key: 'OPEN', label: 'To Do', color: 'gray' },\r\n  { key: 'IN_PROGRESS', label: 'In Progress', color: 'blue' },\r\n  { key: 'DONE', label: 'Done', color: 'green' },\r\n];\r\n\r\nexport default function TasksTable() {\r\n  const [tasks, setTasks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchTasks = () => {\r\n    fetch('/api/tasks')\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (Array.isArray(data)) {\r\n          setTasks(data);\r\n        } else if (data && Array.isArray(data.tasks)) {\r\n          setTasks(data.tasks);\r\n        } else {\r\n          setTasks([]);\r\n        }\r\n        setLoading(false);\r\n      });\r\n  };\r\n  useEffect(() => {\r\n    fetchTasks();\r\n  }, []);\r\n\r\n  if (loading) return <Flex justify=\"center\" align=\"center\" minH=\"200px\"><Spinner size=\"lg\" /></Flex>;\r\n\r\n  // Group tasks by status for columns\r\n  const tasksByStatus: Record<string, any[]> = {};\r\n  statusColumns.forEach(col => {\r\n    tasksByStatus[col.key] = tasks.filter((t: any) => t.status === col.key);\r\n  });\r\n\r\n  const onDragEnd = async (result: any) => {\r\n    const { source, destination, draggableId } = result;\r\n    if (!destination || source.droppableId === destination.droppableId) return;\r\n    const taskId = draggableId;\r\n    const newStatus = destination.droppableId;\r\n    // Optimistically update UI\r\n    setTasks(prev => prev.map((t: any) => t.id === taskId ? { ...t, status: newStatus } : t));\r\n    // Update backend\r\n    await fetch(`/api/tasks/${taskId}/status`, {\r\n      method: 'PATCH',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ status: newStatus })\r\n    });\r\n    // Refetch tasks to sync with backend\r\n    fetchTasks();\r\n  };\r\n\r\n  return (\r\n    <DragDropContext onDragEnd={onDragEnd}>\r\n      <Flex gap={6} overflowX={{ base: 'auto', md: 'visible' }} py={4}>\r\n        {statusColumns.map(col => (\r\n          <Droppable droppableId={col.key} key={col.key}>\r\n            {(provided, snapshot) => (\r\n              <Box\r\n                ref={provided.innerRef}\r\n                {...provided.droppableProps}\r\n                bg={snapshot.isDraggingOver ? '#e3e9f7' : '#f7f8fa'}\r\n                borderRadius=\"lg\"\r\n                minW=\"320px\"\r\n                p={4}\r\n                boxShadow=\"md\"\r\n                flex={1}\r\n              >\r\n                <Heading size=\"md\" mb={4} color={col.color + '.600'}>{col.label}</Heading>\r\n                <VStack align=\"stretch\" spacing={4} minH=\"80px\">\r\n                  {tasksByStatus[col.key].length === 0 && (\r\n                    <Text color=\"gray.400\" fontSize=\"sm\">No tasks</Text>\r\n                  )}\r\n                  {tasksByStatus[col.key].map((t: any, idx: number) => (\r\n                    <Draggable draggableId={t.id} index={idx} key={t.id}>\r\n                      {(provided, snapshot) => (\r\n                        <div\r\n                          ref={provided.innerRef}\r\n                          {...provided.draggableProps}\r\n                          {...provided.dragHandleProps}\r\n                          style={{\r\n                            ...provided.draggableProps.style,\r\n                            opacity: snapshot.isDragging ? 0.7 : 1,\r\n                          }}\r\n                        >\r\n                          <Link href={`/tasks/${t.id}`} style={{ textDecoration: 'none' }}>\r\n                            <Box bg=\"#fff\" borderRadius=\"md\" p={4} boxShadow=\"sm\" _hover={{ boxShadow: 'lg', bg: '#f0f4ff' }} transition=\"all 0.2s\">\r\n                              <Flex align=\"center\" justify=\"space-between\" mb={2}>\r\n                                <Text fontWeight=\"bold\" fontSize=\"md\">{t.title}</Text>\r\n                                <Tag colorScheme={col.color} size=\"sm\">{t.priority}</Tag>\r\n                              </Flex>\r\n                              <Flex align=\"center\" gap={2} fontSize=\"sm\" color=\"gray.600\">\r\n                                <Avatar size=\"xs\" name={t.assigneeName || t.assignedToUserId || 'Unassigned'} />\r\n                                <Text>{t.assigneeName || t.assignedToUserId || 'Unassigned'}</Text>\r\n                                {t.dueDate && <Text ml={2}>Due: {new Date(t.dueDate).toLocaleDateString()}</Text>}\r\n                              </Flex>\r\n                            </Box>\r\n                          </Link>\r\n                        </div>\r\n                      )}\r\n                    </Draggable>\r\n                  ))}\r\n                  {provided.placeholder}\r\n                </VStack>\r\n              </Box>\r\n            )}\r\n          </Droppable>\r\n        ))}\r\n      </Flex>\r\n    </DragDropContext>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}